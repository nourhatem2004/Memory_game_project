<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <style>
        body {
            text-align: center;
            font-family: Arial, sans-serif;
        }

        canvas {
            border: 2px solid #333;
            background-color: #fff;
            margin-top: 10px;
        }

        h1 {
            margin-bottom: 0;
        }
    </style>
</head>

<body>
    <h1>Memory Game</h1>
    <canvas id="gameCanvas" width="600" height="600"></canvas>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");

        const rows = 6;
        const cols = 6;
        const cardSize = 100;
        var chosenCards = false;
        var card1;
        var card2;
        var busy = false;

        const cards = [];
        const imgs = new Array(18).fill(0);




        for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
                cards.push({
                    x: col * cardSize,
                    y: row * cardSize,
                    visible: true,
                    image: null,
                    imgid: null
                });
            }
        }

        drawImages();

        function drawBoard() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            for (const card of cards) {
                if (card.visible) {
                    drawCard(card.x, card.y);
                } else {
                    if (card.image && card.image.complete) {
                        ctx.drawImage(card.image, card.x, card.y, cardSize - 2, cardSize - 2);
                    }
                }
            }
        }

        function drawCard(x, y) {
            ctx.fillStyle = "#cccccc";
            ctx.fillRect(x, y, cardSize - 2, cardSize - 2);
            ctx.strokeStyle = "#999";
            ctx.strokeRect(x, y, cardSize - 2, cardSize - 2);
        }
        function pickrand() {
            do {
                var i = Math.floor(Math.random() * 18);
            }
            while (imgs[i] == 2)

            imgs[i]++;
            console.log(i);
            return i;
        }

        function drawImages() {
            for (let idx = 0; idx < rows * cols; idx++) {
                const rnd = pickrand();
                const imgPath = `images/${rnd + 1}.jpg`;

                const image = new Image();
                image.src = imgPath;

                cards[idx].image = image;
                cards[idx].imgid = rnd;

            }
        }

        function flipCard(card) {
            if(busy || card == card1)return;
            if (chosenCards == false) {
                card1 = card;
                card1.visible = false;
                drawBoard();
                chosenCards = true;
                console.log("revealing first card");
            }
            else {
                console.log("revealing second card for 1 sec");
                card2 = card;
                card2.visible = false;
                drawBoard()
                busy = true;
                setTimeout(() => {
                    if(card1.imgid != card2.imgid){
                        card1.visible = true;
                        card2.visible = true;
                    }
                    console.log("redrawing")
                    drawBoard();
                    chosenCards = false;
                    card1 = null;
                    card2 = null;
                    busy = false;
                }, 1500);

            }
        }

        canvas.addEventListener("click", (event) => {
            
            const rect = canvas.getBoundingClientRect();
            const clickX = event.clientX - rect.left;
            const clickY = event.clientY - rect.top;
            var card1;
            var card2;
            for (const card of cards) {
                if (
                    card.visible &&
                    clickX >= card.x && clickX < card.x + cardSize &&
                    clickY >= card.y && clickY < card.y + cardSize
                ) {
                    flipCard(card);

                    break;
                }
            }
        });

        drawBoard();
    </script>
</body>

</html>